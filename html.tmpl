<!DOCTYPE html>
<html>
	<head>
		<title>Albums: $this_genre.name</title>

		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link href="../style.css" rel="stylesheet" type="text/css" />

		<script type="text/javascript" src="../jquery-1.4.4.min.js"></script> 
		<script type="text/javascript">
		#raw
	
			function sortByDate() {
				var albumcontainer = $('#albums');	
				var albums = albumcontainer.children('div.album').get();

				function readDate(x) {
					var s = $.trim($(x).find("p.releasedate").text());

					var numDashes = 2;
					for (var i = 0; i < s.length; ++i)
						if (s[i] == '-') --numDashes;

					for (var i = 0; i < numDashes; ++i)
						s += " 01";

					return new Date(s.replace(/-/g, ' '));
				}

				albums.sort(function(a, b) {
					var dateA = readDate(a);
					var dateB = readDate(b);

					return dateA - dateB;
				});

				$.each(albums, function(idx, item) { albumcontainer.append(item); });
			}
			
		#end raw
		</script>
	</head>

	<body>
		<h1>Albums</h1>

		<h2>Genres</h2>
		<ul id="genres">
			#for $genre in sorted($genres.keys())
				<li>
					#if $genres[$genre].is_important
						<strong>
					#end if
					<a href="$genres[$genre].clean_name#echo '.html'#\#start">$genre (#echo $genres[$genre].num_albums# albums)</a>
					#if $genres[$genre].is_important
						</strong>
					#end if
				</li>
			#end for
		</ul>

		<h2 id="start">$this_genre.name ($this_genre.num_albums albums)</h2>
		<p style="margin: 20px;">Sort by <a href="javascript:sortByName();">name</a>, <a href="javascript:sortByDate()">release date</a>, <a href="javascript:sortByLastFm()">popularity on last.fm</a>.</p>

		<div id="albums">
		#for $artist in sorted($this_genre.artists.keys())
		#for $album in $this_genre.artists[artist].albums.values()
			<div class="album">
				<img src="../$album.cover_filename" width="128" height="128" />
                <p>$artist &#151; $album.name #if $album.date != ""#[$album.date]#end if#</p>
				<small>
					#set $sep = ''
					[#for $genre in $album.artist.genres#$sep<a href="$genre.clean_name#echo '.html'#\#start">$genre.name</a>#set $sep = ', '##end for#]
				</small>
				<hr />
				<p class="releasedate">$album.date</a>
			</div>
		#end for
        #end for
		</div>
	</body>
</html>
